<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past Tenses Quiz | Grammar Practice</title>
    <meta name="description" content="Interactive English grammar quiz: Past Simple vs Past Continuous">
    <style>
        /* Сброс и базовые переменные */
        :root {
            --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            --color-bg: #f8f9fa;
            --color-surface: #ffffff;
            --color-text-primary: #212529;
            --color-text-secondary: #6c757d;
            --color-border: #e9ecef;
            --color-primary: #4361ee;
            --color-primary-light: #4895ef;
            --color-success: #2b9348;
            --color-error: #d90429;
            --color-warning: #f72585;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --transition: all 0.25s ease;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg: #121212;
                --color-surface: #1e1e1e;
                --color-text-primary: #e0e0e0;
                --color-text-secondary: #a0a0a0;
                --color-border: #333;
                --color-primary: #5e72e4;
                --color-primary-light: #6a81ff;
                --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
                --shadow-md: 0 4px 12px rgba(0,0,0,0.2);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text-primary);
            line-height: 1.6;
            padding: var(--spacing-md);
            min-height: 100vh;
            transition: background-color var(--transition);
        }

        .container {
            max-width: 768px;
            margin: 0 auto;
        }

        .card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            transition: var(--transition);
        }

        h1 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            text-align: center;
            margin-bottom: var(--spacing-md);
            color: var(--color-primary);
        }

        .progress {
            width: 100%;
            height: 6px;
            background-color: var(--color-border);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: clamp(1rem, 3.5vw, 1.25rem);
            margin-bottom: var(--spacing-lg);
            white-space: pre-line;
            color: var(--color-text-primary);
        }

        /* Варианты ответов — адаптивная сетка */
        .options {
            display: grid;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        @media (min-width: 600px) {
            .options {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option {
            padding: var(--spacing-md);
            background: var(--color-bg);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 500;
        }

        .option:hover {
            border-color: var(--color-primary-light);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .option.selected {
            border-color: var(--color-primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .option.correct {
            border-color: var(--color-success);
            background-color: rgba(43, 147, 72, 0.1);
        }

        .option.wrong {
            border-color: var(--color-error);
            background-color: rgba(217, 4, 41, 0.1);
        }

        .feedback {
            padding: var(--spacing-sm);
            margin-top: var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-weight: 500;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .feedback.show {
            opacity: 1;
            height: auto;
            margin-top: var(--spacing-md);
        }

        .feedback.success {
            color: var(--color-success);
        }

        .feedback.error {
            color: var(--color-error);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            background: var(--color-primary);
            color: white;
            transition: var(--transition);
        }

        .btn:hover {
            background: var(--color-primary-light);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
        }

        .btn-outline:hover {
            background: rgba(67, 97, 238, 0.05);
        }

        .btn-danger {
            background: var(--color-error);
        }

        .btn-danger:hover {
            background: #b00320;
        }

        /* Экран результатов */
        .result-screen {
            display: none;
        }

        .score {
            font-size: 1.5rem;
            text-align: center;
            margin: var(--spacing-lg) 0;
            font-weight: 700;
        }

        .mistakes-list {
            list-style: none;
        }

        .mistake-item {
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px dashed var(--color-border);
        }

        .mistake-item:last-child {
            border-bottom: none;
        }

        .mistake-question {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .mistake-user {
            color: var(--color-error);
            text-decoration: line-through;
        }

        .mistake-correct {
            color: var(--color-success);
            font-weight: 600;
        }

        /* Поддержка TV / PS (крупные элементы) */
        @media (min-width: 1200px), (min-height: 800px) {
            .container {
                max-width: 900px;
            }

            .card {
                padding: 2.5rem;
            }

            h1 {
                font-size: 2.5rem;
            }

            .option {
                padding: 1.25rem;
                font-size: 1.1rem;
            }

            .btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
            }
        }

        /* Уменьшение анимаций при предпочтении */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>Past Simple vs Past Continuous</h1>

            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div id="gameArea">
                <div class="question-text" id="questionText">Загрузка...</div>

                <div class="options" id="options"></div>

                <div class="feedback" id="feedback"></div>

                <div class="controls">
                    <button class="btn" id="submitBtn">Проверить →</button>
                    <button class="btn btn-outline" id="resetBtn">Сбросить</button>
                </div>
            </div>

            <div id="resultScreen" class="card result-screen">
                <h2>Результаты теста</h2>
                <div class="score" id="scoreDisplay">0 из 7</div>
                <p id="summaryText">Спасибо за прохождение!</p>

                <div id="mistakesSection" style="display: none;">
                    <h3>Ошибки:</h3>
                    <ul class="mistakes-list" id="mistakesList"></ul>
                </div>

                <div class="controls">
                    <button class="btn" id="restartBtn">Пройти снова</button>
                    <button class="btn btn-outline" id="backBtn">К тесту</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Задания из Test 18 (Past Simple vs Past Continuous)
        const QUESTIONS = [
            {
                text: "I saw a light in your window as I (pass) by.",
                options: ["A) passed", "B) was passing"],
                correctIndex: 0
            },
            {
                text: "Yesterday as I was walking down Cherry Lane, I (meet) Thomas, an old friend of mine.",
                options: ["A) met", "B) was meeting"],
                correctIndex: 0
            },
            {
                text: "Liz’s elder brother said that he (go) to enter Leeds University.",
                options: ["A) went", "B) was going"],
                correctIndex: 1
            },
            {
                text: "While my son (wait) for my call, somebody knocked at the door.",
                options: ["A) waited", "B) was waiting"],
                correctIndex: 1
            },
            {
                text: "We (just / talk) about him when he suddenly (come) in.",
                options: ["A) just talked / came in", "B) were just talking / was coming in"],
                correctIndex: 0
            },
            {
                text: "Yesterday while Dad (shave), he (cut) himself slightly.",
                options: ["A) shaved / cut", "B) was shaving / was cutting"],
                correctIndex: 0
            },
            {
                text: "They (quarrel) while they (wash) their car.",
                options: ["A) quarrelled / washed", "B) were quarrelling / were washing"],
                correctIndex: 0
            }
        ];

        // Состояние
        let currentIdx = 0;
        let score = 0;
        let mistakes = [];
        let selected = null;
        let gameEnded = false;

        // DOM
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('options');
        const progressBar = document.getElementById('progressBar');
        const feedbackEl = document.getElementById('feedback');
        const gameArea = document.getElementById('gameArea');
        const resultScreen = document.getElementById('resultScreen');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const summaryText = document.getElementById('summaryText');
        const mistakesSection = document.getElementById('mistakesSection');
        const mistakesList = document.getElementById('mistakesList');

        // Инициализация
        function init() {
            currentIdx = 0;
            score = 0;
            mistakes = [];
            gameEnded = false;
            selected = null;
            renderQuestion();
            updateProgress();
            gameArea.style.display = 'block';
            resultScreen.style.display = 'none';
        }

        function updateProgress() {
            const percent = (currentIdx / QUESTIONS.length) * 100;
            progressBar.style.width = `${percent}%`;
        }

        function renderQuestion() {
            if (currentIdx >= QUESTIONS.length) {
                endGame();
                return;
            }

            const q = QUESTIONS[currentIdx];
            questionText.textContent = q.text;
            optionsContainer.innerHTML = '';

            q.options.forEach((opt, i) => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.textContent = opt;
                btn.dataset.index = i;
                btn.addEventListener('click', () => selectOption(btn));
                optionsContainer.appendChild(btn);
            });

            feedbackEl.classList.remove('show');
            selected = null;
        }

        function selectOption(optionEl) {
            // Сброс выделения
            document.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
            optionEl.classList.add('selected');
            selected = parseInt(optionEl.dataset.index);
        }

        function checkAnswer() {
            if (selected === null) {
                showFeedback('Выберите вариант ответа.', 'error');
                return;
            }

            const q = QUESTIONS[currentIdx];
            const isCorrect = selected === q.correctIndex;

            if (isCorrect) {
                score++;
                showFeedback('✅ Верно!', 'success');
                highlightOption(selected, 'correct');
            } else {
                mistakes.push({
                    question: q.text,
                    user: q.options[selected],
                    correct: q.options[q.correctIndex]
                });
                showFeedback(`❌ Неверно. Правильный ответ: ${q.options[q.correctIndex]}`, 'error');
                highlightOption(selected, 'wrong');
                highlightOption(q.correctIndex, 'correct');
            }

            setTimeout(() => {
                currentIdx++;
                if (currentIdx < QUESTIONS.length) {
                    renderQuestion();
                    updateProgress();
                } else {
                    endGame();
                }
            }, 1800);
        }

        function highlightOption(index, cls) {
            const optionEls = document.querySelectorAll('.option');
            if (optionEls[index]) {
                optionEls[index].classList.add(cls);
            }
        }

        function showFeedback(text, type) {
            feedbackEl.textContent = text;
            feedbackEl.className = `feedback ${type}`;
            feedbackEl.classList.add('show');
        }

        function endGame() {
            gameEnded = true;
            gameArea.style.display = 'none';
            resultScreen.style.display = 'block';

            scoreDisplay.textContent = `${score} из ${QUESTIONS.length}`;

            const pct = Math.round((score / QUESTIONS.length) * 100);
            let msg = '';
            if (pct === 100) msg = 'Превосходно! Полное понимание времён.'; 
            else if (pct >= 80) msg = 'Отлично! Небольшие недочёты.';
            else if (pct >= 60) msg = 'Хорошо. Повторите правила Past Continuous.';
            else msg = 'Тема требует повторения. Не сдавайтесь!';
            summaryText.textContent = msg;

            // Ошибки
            if (mistakes.length > 0) {
                mistakesSection.style.display = 'block';
                mistakesList.innerHTML = '';
                mistakes.forEach(m => {
                    const li = document.createElement('li');
                    li.className = 'mistake-item';
                    li.innerHTML = `
                        <div class="mistake-question">${m.question}</div>
                        <div><span class="mistake-user">${m.user}</span> → <span class="mistake-correct">${m.correct}</span></div>
                    `;
                    mistakesList.appendChild(li);
                });
            } else {
                mistakesSection.style.display = 'none';
            }
        }

        // Обработчики
        document.getElementById('submitBtn').addEventListener('click', checkAnswer);
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Сбросить прогресс и начать заново?')) init();
        });
        document.getElementById('restartBtn').addEventListener('click', init);
        document.getElementById('backBtn').addEventListener('click', () => {
            gameArea.style.display = 'block';
            resultScreen.style.display = 'none';
            renderQuestion();
        });

        // Поддержка клавиатуры
        document.addEventListener('keydown', (e) => {
            if (gameEnded) return;

            // 1-7 или A/B выбор
            if (e.key === '1' || e.key === '2') {
                const idx = parseInt(e.key) - 1;
                const optionEl = document.querySelector(`.option[data-index="${idx}"]`);
                if (optionEl) selectOption(optionEl);
            } else if (e.key === 'A' || e.key === 'a') {
                const optionEl = document.querySelector('.option[data-index="0"]');
                if (optionEl) selectOption(optionEl);
            } else if (e.key === 'B' || e.key === 'b') {
                const optionEl = document.querySelector('.option[data-index="1"]');
                if (optionEl) selectOption(optionEl);
            } else if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // Запуск
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>